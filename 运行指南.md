# AI 学习伴侣 - 运行指南

## 🚀 快速开始

### 方法一：使用 Xcode（推荐 - 最简单）

#### 第一步：创建新项目

1. **打开 Xcode**
2. **创建新项目**：
   - 菜单：**文件 → 新建 → 项目** (⌘⇧N)
   - 选择 **macOS** 标签页
   - 选择 **App**
   - 点击 **下一步**

3. **填写项目信息**：
   - **产品名称**：`AILearningCompanion`
   - **团队**：选择你的开发团队
   - **组织标识符**：`com.yourcompany`（或你的域名）
   - **界面**：**SwiftUI**
   - **语言**：**Swift**
   - **存储**：**None**
   - 点击 **创建**

#### 第二步：添加源代码

1. 在 Xcode 项目导航器中，**右键点击项目名称**
2. 选择 **"将文件添加到 AILearningCompanion..."**
3. 导航到并选择 **`Sources`** 文件夹
4. 确保：
   - ✅ **创建组** 已选中
   - ✅ **添加到目标: AILearningCompanion** 已选中
   - ❌ **取消勾选 "如果需要则复制项目"**（使用引用）
5. 点击 **添加**

#### 第三步：配置应用入口

1. 打开 `AILearningCompanionApp.swift`（或 `App.swift`）
2. 替换内容为：

```swift
import SwiftUI

@main
struct AILearningCompanionApp: App {
    @StateObject private var themeManager = ThemeManager()
    @StateObject private var appState = AppState()
    
    var body: some Scene {
        WindowGroup {
            MainView()
                .environmentObject(themeManager)
                .environmentObject(appState)
                .preferredColorScheme(themeManager.colorScheme)
        }
        #if os(macOS)
        .windowStyle(.automatic)
        .defaultSize(width: 1000, height: 700)
        #endif
        .commands {
            CommandGroup(replacing: .newItem) {}
            
            CommandMenu("学习") {
                Button("新建学习会话") {
                    // TODO: 打开新的学习会话
                }
                .keyboardShortcut("n", modifiers: .command)
                
                Button("生成闪卡") {
                    // TODO: 打开闪卡生成器
                }
                .keyboardShortcut("f", modifiers: .command)
            }
        }
        
        #if os(macOS)
        Settings {
            SettingsView()
                .environmentObject(themeManager)
                .environmentObject(appState)
        }
        #endif
    }
}
```

#### 第四步：配置构建设置

1. 在项目导航器中选择项目
2. 选择 **AILearningCompanion** 目标
3. 进入 **常规** 标签：
   - **最低部署版本**：macOS 13.0
4. 进入 **签名与功能** 标签：
   - 启用 **App Sandbox**
   - 添加功能：
     - ✅ **传出连接（客户端）**
     - ✅ **用户选择的文件（读/写）**

#### 第五步：添加权限文件

1. **文件 → 新建 → 文件**
2. 选择 **macOS → 资源 → Property List**
3. 命名为：`AILearningCompanion.entitlements`
4. 添加以下键值（或使用项目根目录提供的 entitlements 文件）：
   - `com.apple.security.app-sandbox` = `YES`
   - `com.apple.security.files.user-selected.read-write` = `YES`
   - `com.apple.security.network.client` = `YES`

#### 第六步：运行！

1. 在 Xcode 顶部选择 **"我的 Mac"** 作为运行目标
2. 按 **⌘R** 构建并运行
3. 应用应该会启动！

---

### 方法二：使用 Swift Package Manager

```bash
# 1. 克隆仓库（如果还没有）
git clone https://github.com/yourusername/live2d-kanban-desktop.git
cd live2d-kanban-desktop

# 2. 构建项目
swift build

# 注意：SPM 构建的是库，不是应用。要创建应用包，仍需要使用 Xcode
```

---

### 方法三：使用构建脚本

```bash
# 1. 进入项目目录
cd live2d-kanban-desktop

# 2. 使构建脚本可执行
chmod +x build_macos.sh

# 3. 运行构建脚本
./build_macos.sh
```

---

## ⚙️ 首次运行配置

### 1. 设置 API 密钥

1. 打开应用
2. 按 **⌘,** 打开设置
3. 在 **"AI 配置"** 部分输入你的 OpenAI API 密钥
4. 点击 **"测试连接"** 验证

> **获取 API 密钥**：访问 https://platform.openai.com/api-keys

### 2. 加载 Live2D 模型（可选）

1. 将 Live2D 模型文件放在 `Resources/Models/` 目录
2. 或在设置中指定模型路径

### 3. 开始使用

- 点击 **"Ask AI"** 开始对话
- 使用 **"OCR"** 从图片提取文字
- 生成闪卡和问题
- 启动番茄钟学习

---

## 📋 系统要求

- **macOS 13.0 (Ventura)** 或更高版本
- **Xcode 14.0** 或更高版本（用于构建）
- **OpenAI API 密钥**（用于 AI 功能）

---

## ❓ 常见问题

### 构建错误

**问题**："找不到类型 'X'"
- **解决**：确保 `Sources` 文件夹中的所有文件都已添加到目标
- **检查**：在文件检查器中查看目标成员资格

**问题**：Metal 编译错误
- **解决**：确保你的 Mac 支持 Metal（所有现代 Mac 都支持）
- **检查**：系统信息 → 图形/显示器

**问题**：网络错误
- **解决**：验证权限文件允许网络访问
- **检查**：设置中的 API 密钥配置

### 运行时问题

**问题**：应用启动时崩溃
- **解决**：检查控制台错误信息
- **检查**：确保所有依赖项都已链接

**问题**：Live2D 不显示
- **解决**：确保 Metal 支持
- **检查**：模型文件位置是否正确

**问题**：设置无法保存
- **解决**：验证 UserDefaults 访问
- **检查**：应用沙盒权限

---

## 🎯 功能使用说明

### 💬 与 AI 对话

1. 点击主界面的 **"Ask AI"** 按钮
2. 在聊天界面输入问题
3. AI 会提供解释、学习建议和帮助
4. 对话历史在会话期间保持

### 📸 OCR 文字提取

1. 点击 **"OCR"** 按钮
2. 选择或粘贴图片
3. 使用 Vision 框架自动提取文字
4. 使用提取的文字生成闪卡或问题

### 🎴 生成闪卡

1. 点击 **"Flashcards"** 按钮
2. 粘贴或输入学习材料
3. AI 自动创建问答对
4. 复习和学习你的闪卡

### ⏱️ 番茄钟

1. 点击 **"Pomodoro"** 按钮
2. 开始 25 分钟专注会话
3. 自动休息和进度跟踪
4. 角色会根据学习状态做出反应

### 🎭 Live2D 角色

- 交互式角色响应你的活动
- 表情根据学习进度变化
- 浮动窗口模式，始终可见
- 可拖动到屏幕任意位置

---

## 📚 更多帮助

- **详细设置指南**：查看 [XCODE_SETUP.md](./XCODE_SETUP.md)
- **构建说明**：查看 [BUILD_INSTRUCTIONS.md](./BUILD_INSTRUCTIONS.md)
- **架构文档**：查看 [Docs/Architecture.md](./Docs/Architecture.md)
- **英文 README**：查看 [README.md](./README.md)

---

## 🆘 需要帮助？

如果遇到问题：

1. 检查 **常见问题** 部分
2. 查看控制台错误信息
3. 在 GitHub Issues 中报告问题
4. 查看详细文档

---

**祝你学习愉快！** 🎓✨

